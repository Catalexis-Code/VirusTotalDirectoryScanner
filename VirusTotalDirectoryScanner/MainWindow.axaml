<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="using:VirusTotalDirectoryScanner.Models"
        xmlns:vm="using:VirusTotalDirectoryScanner.ViewModels"
        x:Class="VirusTotalDirectoryScanner.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="VirusTotalDirectoryScanner"
        WindowStartupLocation="CenterScreen"
        Width="520"
        Height="600"
        x:Name="RootWindow">
  <Grid Margin="16" RowDefinitions="Auto,Auto,*,Auto" RowSpacing="12">
    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
      <TextBlock FontSize="20" FontWeight="SemiBold" Text="VirusTotalDirectoryScanner" />
      <Button Grid.Column="1" Content="Settingsâ€¦" Command="{Binding OpenSettingsCommand}" />
    </Grid>

    <Separator Grid.Row="1" />

    <Grid Grid.Row="2" RowDefinitions="Auto, *">
      <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,10">
        <StackPanel Spacing="8">
          <TextBlock FontWeight="SemiBold" Text="Monitoring" />
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center" />
            <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsMonitoring}">
              <TextBlock Text="{Binding ScanDirectoryName}" ToolTip.Tip="{Binding ScanDirectoryPath}" FontWeight="Bold" VerticalAlignment="Center" />
              <Button Command="{Binding BrowseDirectoryCommand}" ToolTip.Tip="Change Directory" Padding="4" Background="Transparent">
                <PathIcon Data="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z" Width="16" Height="16" />
              </Button>
              <Button Command="{Binding OpenDirectoryCommand}" ToolTip.Tip="Open in Explorer" Padding="4" Background="Transparent">
                <PathIcon Data="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" Width="16" Height="16" />
              </Button>
            </StackPanel>
          </StackPanel>
        </StackPanel>
        <Button Grid.Column="1" Content="Clear" Command="{Binding ClearCommand}" VerticalAlignment="Bottom" />
      </Grid>

      <DataGrid Grid.Row="1" ItemsSource="{Binding ScanResults}" AutoGenerateColumns="False" IsReadOnly="True">
        <DataGrid.Columns>
          <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="*" />
          <DataGridTemplateColumn Header="Status" Width="200">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate DataType="models:ScanResult">
                <Panel>
                  <!-- Scanning -->
                  <StackPanel Orientation="Horizontal" Spacing="5" IsVisible="{Binding IsScanning}">
                    <ProgressBar IsIndeterminate="True" Width="20" Height="20" />
                    <TextBlock Text="Scanning..." VerticalAlignment="Center" />
                  </StackPanel>

                  <!-- Clean -->
                  <StackPanel Orientation="Horizontal" Spacing="5" IsVisible="{Binding IsClean}">
                    <PathIcon Data="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" Foreground="Green" />
                    <TextBlock Text="Clean" VerticalAlignment="Center" Foreground="Green" />
                  </StackPanel>

                  <!-- Compromised -->
                  <Button Command="{Binding #RootWindow.DataContext.OpenReportCommand}" CommandParameter="{Binding}" IsVisible="{Binding IsCompromised}" Padding="0" Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                      <PathIcon Data="M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.49,5 12,5C11.51,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8M16,15H8V11H16V15Z" Foreground="Red" />
                      <TextBlock Text="{Binding StatusDisplay}" VerticalAlignment="Center" Foreground="Red" TextDecorations="Underline" />
                    </StackPanel>
                  </Button>

                  <!-- Other -->
                  <TextBlock Text="{Binding StatusDisplay}" VerticalAlignment="Center" IsVisible="{Binding IsOther}" />
                </Panel>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
        </DataGrid.Columns>
      </DataGrid>
    </Grid>

    <!-- Error Section -->
    <Border Grid.Row="3" BorderBrush="#FFCDD2" Background="#FFEBEE" BorderThickness="1" CornerRadius="4" Padding="8" IsVisible="{Binding HasError}">
      <StackPanel Orientation="Horizontal" Spacing="8">
        <PathIcon Data="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z" Foreground="#D32F2F" Width="20" Height="20" VerticalAlignment="Top" />
        <TextBlock Text="{Binding ErrorMessage}" Foreground="#D32F2F" VerticalAlignment="Center" TextWrapping="Wrap" />
      </StackPanel>
    </Border>
  </Grid>
</Window>
